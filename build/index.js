(()=>{"use strict";var e={n:t=>{var n=t&&t.__esModule?()=>t.default:()=>t;return e.d(n,{a:n}),n},d:(t,n)=>{for(var r in n)e.o(n,r)&&!e.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:n[r]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};const t=window.React,n=(window.wp.plugins,window.wp.hooks),r=window.wp.compose,o=window.wp.element,a=window.wp.blockEditor,l=window.wp.components,c=window.wp.i18n,i=window.wp.data,s=window.wp.apiFetch;var u=e.n(s);function m(e,t){const n=document.querySelector(`[data-block="${e}"]`);n&&(t?n.classList.add("gutenblock-ai-generating"):n.classList.remove("gutenblock-ai-generating"))}const d=({usage:e})=>{if(!e)return null;if(e.is_pro)return(0,t.createElement)("div",{className:"gb-ai-tokens gb-ai-tokens-pro"},(0,t.createElement)("span",{className:"dashicons dashicons-awards"}),(0,c.__)("Unbegrenzte Tokens (Pro)","gutenblock-pro"));const n=Math.min(100,e.used/e.limit*100),r=n>95?"critical":n>80?"warning":"";return(0,t.createElement)("div",{className:"gb-ai-tokens"},(0,t.createElement)("div",{className:"gb-ai-tokens-bar"},(0,t.createElement)("div",{className:`gb-ai-tokens-progress ${r}`,style:{width:`${n}%`}})),(0,t.createElement)("div",{className:"gb-ai-tokens-text"},e.used.toLocaleString()," / ",e.limit.toLocaleString()," Tokens"))},p=({clientId:e,blockName:n,attributes:r})=>{const[a,s]=(0,o.useState)(!1),[p,h]=(0,o.useState)(""),[E,w]=(0,o.useState)(""),[_,f]=(0,o.useState)(null),[P,y]=(0,o.useState)({}),[B,N]=(0,o.useState)(""),{updateBlockAttributes:v}=(0,i.useDispatch)("core/block-editor"),{getBlocks:x}=(0,i.useSelect)(e=>({getBlocks:e("core/block-editor").getBlocks})),C=r?.metadata?.name||"",S=["core/group","core/columns","core/cover","core/column"].includes(n);(0,o.useEffect)(()=>{u()({path:"/gutenblock-pro/v1/prompts"}).then(e=>{y(e||{}),C&&e[C]&&w(e[C].prompt||"")}).catch(e=>console.error("Error loading prompts:",e)),u()({path:"/gutenblock-pro/v1/ai/usage"}).then(e=>f(e)).catch(e=>console.error("Error loading usage:",e))},[]),(0,o.useEffect)(()=>{C&&P[C]&&w(P[C].prompt||"")},[C,P]);const I=(0,o.useMemo)(()=>{const e=Object.entries(P).map(([e])=>({value:e,label:e}));return e.sort((e,t)=>e.label.localeCompare(t.label)),e},[P]),F=async(t=null)=>{s(!0),h(""),m(e,!0);try{const o=g(n,r),a=await u()({path:"/gutenblock-pro/v1/ai/generate",method:"POST",data:{prompt:E,blockName:C||n,currentText:o,feedback:t}});a.success&&a.text&&(k(e,n,a.text,v),a.usage&&f(a.usage))}catch(e){h(e.message||(0,c.__)("Fehler bei der Generierung","gutenblock-pro"))}finally{s(!1),m(e,!1)}};if(S)return(0,t.createElement)(b,{clientId:e,blockName:n,attributes:r});if(!["core/paragraph","core/heading","core/button","core/list-item"].includes(n))return null;const T=E&&E.trim().length>=3;return(0,t.createElement)(l.PanelBody,{title:(0,c.__)("GutenBlock AI","gutenblock-pro"),initialOpen:!0},(0,t.createElement)(l.PanelRow,null,(0,t.createElement)(d,{usage:_})),(0,t.createElement)(l.PanelRow,null,(0,t.createElement)("div",{className:"gb-ai-field-selector"},(0,t.createElement)(l.ComboboxControl,{label:(0,c.__)("Content-Feld","gutenblock-pro"),value:C,onChange:t=>{if(!t)return v(e,{metadata:{...r.metadata,name:void 0}}),void w("");v(e,{metadata:{...r.metadata,name:t}}),P[t]&&w(P[t].prompt||"")},options:I,onFilterValueChange:e=>N(e),__next40pxDefaultSize:!0,__nextHasNoMarginBottom:!0}),C&&(0,t.createElement)("div",{className:"gb-ai-field-badge"},(0,t.createElement)("span",{className:"dashicons dashicons-yes-alt"}),C))),(0,t.createElement)(l.PanelRow,null,(0,t.createElement)(l.TextareaControl,{label:C?(0,c.__)("Prompt (aus Content-Feld)","gutenblock-pro"):(0,c.__)("Eigener Prompt","gutenblock-pro"),value:E,onChange:w,placeholder:(0,c.__)("WÃ¤hle ein Content-Feld oder schreibe einen eigenen Prompt...","gutenblock-pro"),rows:3,help:C?(0,c.__)("Der Prompt wird aus dem Content-Feld geladen. Du kannst ihn hier temporÃ¤r anpassen.","gutenblock-pro"):null,__nextHasNoMarginBottom:!0})),(0,t.createElement)(l.PanelRow,null,(0,t.createElement)("div",{className:"gb-ai-buttons"},(0,t.createElement)(l.Button,{isPrimary:!0,onClick:()=>F(),disabled:a||!T,className:"gb-ai-btn-generate"},a?(0,t.createElement)(l.Spinner,null):(0,c.__)("Generieren","gutenblock-pro")),(0,t.createElement)("div",{className:"gb-ai-btn-row"},(0,t.createElement)(l.Button,{isSecondary:!0,onClick:()=>F("Leicht Ã¤ndern, andere Wortwahl."),disabled:a||!T,size:"small"},(0,c.__)("Variante","gutenblock-pro")),(0,t.createElement)(l.Button,{isSecondary:!0,onClick:()=>F("Komplett anderer Ansatz."),disabled:a||!T,size:"small"},(0,c.__)("Neu","gutenblock-pro"))),(0,t.createElement)("div",{className:"gb-ai-btn-row"},(0,t.createElement)(l.Button,{isSecondary:!0,onClick:()=>F("VerlÃ¤ngere den Text um 10%."),disabled:a||!T,size:"small"},(0,c.__)("+10%","gutenblock-pro")),(0,t.createElement)(l.Button,{isSecondary:!0,onClick:()=>F("KÃ¼rze den Text um 10%."),disabled:a||!T,size:"small"},(0,c.__)("-10%","gutenblock-pro")),(0,t.createElement)(l.Button,{isSecondary:!0,onClick:async()=>{s(!0),h(""),m(e,!0);try{const t=g(n,r);if(!t||t.length<3)return h((0,c.__)("Mindestens 3 Zeichen Text erforderlich","gutenblock-pro")),m(e,!1),void s(!1);const o=await u()({path:"/gutenblock-pro/v1/ai/generate",method:"POST",data:{prompt:`Ãœbersetze den folgenden Text ins Englische. Antworte nur mit der Ãœbersetzung:\n\n${t}`,blockName:"translation"}});o.success&&o.text&&(k(e,n,o.text,v),o.usage&&f(o.usage))}catch(e){h(e.message||(0,c.__)("Fehler bei der Ãœbersetzung","gutenblock-pro"))}finally{s(!1),m(e,!1)}},disabled:a,size:"small"},(0,c.__)("â†’ EN","gutenblock-pro"))))),p&&(0,t.createElement)(l.PanelRow,null,(0,t.createElement)(l.Notice,{status:"error",isDismissible:!1},p)))};function g(e,t){switch(e){case"core/paragraph":case"core/heading":case"core/list-item":return t?.content||"";case"core/button":return t?.text||"";default:return""}}const b=({clientId:e,blockName:n,attributes:r})=>{const[a,s]=(0,o.useState)(!1),[p,b]=(0,o.useState)(""),[h,E]=(0,o.useState)(""),[w,_]=(0,o.useState)({}),[f,P]=(0,o.useState)(null),{updateBlockAttributes:y}=(0,i.useDispatch)("core/block-editor"),B=(0,i.useSelect)(t=>t("core/block-editor").getBlock(e),[e]);(0,o.useEffect)(()=>{u()({path:"/gutenblock-pro/v1/prompts"}).then(e=>_(e||{})).catch(e=>console.error("Error loading prompts:",e)),u()({path:"/gutenblock-pro/v1/ai/usage"}).then(e=>P(e)).catch(e=>console.error("Error loading usage:",e))},[]);const N=(0,o.useMemo)(()=>{if(!B||!B.innerBlocks||0===Object.keys(w).length)return[];const e=new Map;return function t(n){n&&Array.isArray(n)&&n.forEach(n=>{if(!n||!n.clientId)return;if(e.has(n.clientId))return;const r=n.attributes?.metadata?.name;if(r&&w[r]){const t=g(n.name,n.attributes);e.set(n.clientId,{clientId:n.clientId,blockName:n.name,fieldName:r,prompt:w[r].prompt||"",currentText:t,attributes:n.attributes})}n.innerBlocks&&n.innerBlocks.length>0&&t(n.innerBlocks)})}(B.innerBlocks),Array.from(e.values())},[B,w]);return(0,o.useEffect)(()=>{if(N.length>0&&!h){const e=[...new Set(N.map(e=>e.fieldName))].join(", ");E(`Generiere passende Inhalte fÃ¼r alle folgenden Content-Felder: ${e}`)}},[N,h]),(0,t.createElement)(l.PanelBody,{title:(0,c.__)("GutenBlock AI - Gruppe","gutenblock-pro"),initialOpen:!0},(0,t.createElement)(l.PanelRow,null,(0,t.createElement)(d,{usage:f})),(0,t.createElement)(l.PanelRow,null,(0,t.createElement)("div",{className:"gb-ai-group-fields"},(0,t.createElement)("strong",null,(0,c.__)("Gefundene Content-Felder:","gutenblock-pro")),0===N.length?(0,t.createElement)("p",{style:{color:"#757575",fontSize:"12px",marginTop:"8px"}},(0,c.__)("Keine Content-Felder mit metadata.name in dieser Gruppe gefunden.","gutenblock-pro")):(0,t.createElement)("ul",{style:{marginTop:"8px",marginBottom:"16px",paddingLeft:"20px"}},N.map((e,n)=>(0,t.createElement)("li",{key:n,style:{marginBottom:"4px",fontSize:"12px"}},(0,t.createElement)("strong",null,e.fieldName)," (",e.blockName,")"))))),(0,t.createElement)(l.PanelRow,null,(0,t.createElement)(l.TextareaControl,{label:(0,c.__)("Gruppen-Prompt","gutenblock-pro"),value:h,onChange:E,placeholder:(0,c.__)("Beschreibe, was fÃ¼r alle Content-Felder generiert werden soll...","gutenblock-pro"),rows:3,help:(0,c.__)("Dieser Prompt wird fÃ¼r alle Content-Felder in der Gruppe verwendet.","gutenblock-pro"),__nextHasNoMarginBottom:!0})),(0,t.createElement)(l.PanelRow,null,(0,t.createElement)(l.Button,{isPrimary:!0,onClick:()=>(async(e=null)=>{if(0!==N.length){s(!0),b(""),N.forEach(e=>{m(e.clientId,!0)});try{const t=N.map(e=>({clientId:e.clientId,blockName:e.blockName,fieldName:e.fieldName,prompt:e.prompt,currentText:e.currentText})),n=await u()({path:"/gutenblock-pro/v1/ai/generate-group",method:"POST",data:{groupPrompt:h||"",fields:t,feedback:e}});n.success&&n.fields?(n.fields.forEach(e=>{const t=N.find(t=>t.clientId===e.clientId);t&&k(t.clientId,t.blockName,e.text,y)}),n.usage):b(n.message||(0,c.__)("Fehler bei der Generierung","gutenblock-pro"))}catch(e){b(e.message||(0,c.__)("Fehler bei der Generierung","gutenblock-pro"))}finally{s(!1),N.forEach(e=>{m(e.clientId,!1)})}}else b((0,c.__)("Keine Content-Felder in dieser Gruppe gefunden.","gutenblock-pro"))})(),disabled:a||0===N.length||!h.trim(),className:"gb-ai-btn-generate"},a?(0,t.createElement)(l.Spinner,null):(0,c.__)("Alle Felder generieren","gutenblock-pro")),0===N.length&&(0,t.createElement)("p",{style:{color:"#757575",fontSize:"12px",marginTop:"8px"}},(0,c.__)("Hinweis: FÃ¼ge BlÃ¶cke mit metadata.name in diese Gruppe ein, um sie hier zu sehen.","gutenblock-pro"))),p&&(0,t.createElement)(l.PanelRow,null,(0,t.createElement)(l.Notice,{status:"error",isDismissible:!1},p)))};function k(e,t,n,r){switch(t){case"core/paragraph":case"core/heading":case"core/list-item":r(e,{content:n});break;case"core/button":r(e,{text:n})}}const h=(0,r.createHigherOrderComponent)(e=>n=>{const{clientId:r,name:l,attributes:c}=n,i=window.gutenblockProConfig?.hasPremium||!1,[s,u]=(0,o.useState)(!1);return(0,o.useEffect)(()=>{const e=()=>{const e=document.querySelector(`[data-block="${r}"]`);if(e){const t=e.classList.contains("gb-pattern-premium")||null!==e.closest(".gb-pattern-premium");u(t)}},t=setTimeout(e,100),n=new MutationObserver(e),o=document.querySelector(`[data-block="${r}"]`);return o&&n.observe(o,{attributes:!0,subtree:!0}),()=>{clearTimeout(t),n.disconnect()}},[r]),s&&!i?(0,t.createElement)(e,{...n}):(0,t.createElement)(o.Fragment,null,(0,t.createElement)(e,{...n}),(0,t.createElement)(a.InspectorControls,null,(0,t.createElement)(p,{clientId:r,blockName:l,attributes:c})))},"withAIControls");(0,n.addFilter)("editor.BlockEdit","gutenblock-pro/ai-controls",h,10),(0,n.addFilter)("blocks.registerBlockType","gutenblock-pro/premium-block-supports",(e,t)=>("core/cover"!==t&&"core/group"!==t||e.supports,e),999);const E=(0,r.createHigherOrderComponent)(e=>n=>{const{clientId:r,attributes:i,name:s}=n,u=window.gutenblockProConfig?.hasPremium||!1,m=window.gutenblockProConfig?.upgradeUrl||"https://app.gutenblock.com/licenses",d="core/cover"===s||"core/group"===s,p=i?.className||"";return d&&(p.includes("gb-section-hero-v2")||p.includes("gb-section-cta-v1")||p.includes("gb-pattern-premium"))&&!u?(console.log("[GutenBlock Pro] ðŸ”’ Locking premium pattern:",r,p),(0,t.createElement)(o.Fragment,null,(0,t.createElement)(e,{...n}),(0,t.createElement)(a.InspectorControls,null,(0,t.createElement)(l.PanelBody,{title:(0,c.__)("Premium Pattern","gutenblock-pro"),initialOpen:!0,"data-gb-premium-notice":"true"},(0,t.createElement)(l.PanelRow,null,(0,t.createElement)(l.Notice,{status:"warning",isDismissible:!1},(0,t.createElement)("p",{style:{marginBottom:"12px"}},(0,t.createElement)("strong",null,(0,c.__)("ðŸ”’ Pro Plus erforderlich","gutenblock-pro"))),(0,t.createElement)("p",{style:{marginBottom:"12px"}},(0,c.__)("Dieses Pattern kann als Vorschau eingefÃ¼gt werden, ist aber nur mit GutenBlock Pro Plus bearbeitbar.","gutenblock-pro")),(0,t.createElement)(l.Button,{isPrimary:!0,onClick:()=>window.open(m,"_blank"),style:{marginTop:"8px"}},(0,c.__)("Jetzt upgraden","gutenblock-pro")))))))):(0,t.createElement)(e,{...n})},"withPremiumBlockLock");(0,n.addFilter)("editor.BlockEdit","gutenblock-pro/premium-lock",E,999),console.log("GutenBlock Pro AI loaded")})();