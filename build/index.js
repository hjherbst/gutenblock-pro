(()=>{"use strict";var e={n:t=>{var n=t&&t.__esModule?()=>t.default:()=>t;return e.d(n,{a:n}),n},d:(t,n)=>{for(var r in n)e.o(n,r)&&!e.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:n[r]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};const t=window.React,n=(window.wp.plugins,window.wp.hooks),r=window.wp.compose,o=window.wp.element,a=window.wp.blockEditor,l=window.wp.components,c=window.wp.i18n,s=window.wp.data,i=window.wp.apiFetch;var u=e.n(i);function m(e,t){const n=document.querySelector(`[data-block="${e}"]`);n&&(t?n.classList.add("gutenblock-ai-generating"):n.classList.remove("gutenblock-ai-generating"))}const d=({usage:e})=>{if(!e)return null;if(e.is_pro)return(0,t.createElement)("div",{className:"gb-ai-tokens gb-ai-tokens-pro"},(0,t.createElement)("span",{className:"dashicons dashicons-awards"}),(0,c.__)("Unbegrenzte Tokens (Pro)","gutenblock-pro"));const n=Math.min(100,e.used/e.limit*100),r=n>95?"critical":n>80?"warning":"";return(0,t.createElement)("div",{className:"gb-ai-tokens"},(0,t.createElement)("div",{className:"gb-ai-tokens-bar"},(0,t.createElement)("div",{className:`gb-ai-tokens-progress ${r}`,style:{width:`${n}%`}})),(0,t.createElement)("div",{className:"gb-ai-tokens-text"},e.used.toLocaleString()," / ",e.limit.toLocaleString()," Tokens"))},p=({clientId:e,blockName:n,attributes:r})=>{const[a,i]=(0,o.useState)(!1),[p,k]=(0,o.useState)(""),[w,h]=(0,o.useState)(""),[E,_]=(0,o.useState)(null),[P,f]=(0,o.useState)({}),[v,y]=(0,o.useState)(""),{updateBlockAttributes:C}=(0,s.useDispatch)("core/block-editor"),N=r?.metadata?.name||"";(0,o.useEffect)(()=>{u()({path:"/gutenblock-pro/v1/prompts"}).then(e=>{f(e||{}),N&&e[N]&&h(e[N].prompt||"")}).catch(e=>console.error("Error loading prompts:",e)),u()({path:"/gutenblock-pro/v1/ai/usage"}).then(e=>_(e)).catch(e=>console.error("Error loading usage:",e))},[]),(0,o.useEffect)(()=>{N&&P[N]&&h(P[N].prompt||"")},[N,P]);const S=(0,o.useMemo)(()=>{const e=Object.entries(P).map(([e])=>({value:e,label:e}));return e.sort((e,t)=>e.label.localeCompare(t.label)),e},[P]),B=async(t=null)=>{i(!0),k(""),m(e,!0);try{const o=g(n,r),a=await u()({path:"/gutenblock-pro/v1/ai/generate",method:"POST",data:{prompt:w,blockName:N||n,currentText:o,feedback:t}});a.success&&a.text&&(b(e,n,a.text,C),a.usage&&_(a.usage))}catch(e){k(e.message||(0,c.__)("Fehler bei der Generierung","gutenblock-pro"))}finally{i(!1),m(e,!1)}};if(!["core/paragraph","core/heading","core/button","core/list-item"].includes(n))return null;const x=w&&w.trim().length>=3;return(0,t.createElement)(l.PanelBody,{title:(0,c.__)("GutenBlock AI","gutenblock-pro"),initialOpen:!0},(0,t.createElement)(l.PanelRow,null,(0,t.createElement)(d,{usage:E})),(0,t.createElement)(l.PanelRow,null,(0,t.createElement)("div",{className:"gb-ai-field-selector"},(0,t.createElement)(l.ComboboxControl,{label:(0,c.__)("Content-Feld","gutenblock-pro"),value:N,onChange:t=>{if(!t)return C(e,{metadata:{...r.metadata,name:void 0}}),void h("");C(e,{metadata:{...r.metadata,name:t}}),P[t]&&h(P[t].prompt||"")},options:S,onFilterValueChange:e=>y(e)}),N&&(0,t.createElement)("div",{className:"gb-ai-field-badge"},(0,t.createElement)("span",{className:"dashicons dashicons-yes-alt"}),N))),(0,t.createElement)(l.PanelRow,null,(0,t.createElement)(l.TextareaControl,{label:N?(0,c.__)("Prompt (aus Content-Feld)","gutenblock-pro"):(0,c.__)("Eigener Prompt","gutenblock-pro"),value:w,onChange:h,placeholder:(0,c.__)("WÃ¤hle ein Content-Feld oder schreibe einen eigenen Prompt...","gutenblock-pro"),rows:3,help:N?(0,c.__)("Der Prompt wird aus dem Content-Feld geladen. Du kannst ihn hier temporÃ¤r anpassen.","gutenblock-pro"):null})),(0,t.createElement)(l.PanelRow,null,(0,t.createElement)("div",{className:"gb-ai-buttons"},(0,t.createElement)(l.Button,{isPrimary:!0,onClick:()=>B(),disabled:a||!x,className:"gb-ai-btn-generate"},a?(0,t.createElement)(l.Spinner,null):(0,c.__)("Generieren","gutenblock-pro")),(0,t.createElement)("div",{className:"gb-ai-btn-row"},(0,t.createElement)(l.Button,{isSecondary:!0,onClick:()=>B("Leicht Ã¤ndern, andere Wortwahl."),disabled:a||!x,size:"small"},(0,c.__)("Variante","gutenblock-pro")),(0,t.createElement)(l.Button,{isSecondary:!0,onClick:()=>B("Komplett anderer Ansatz."),disabled:a||!x,size:"small"},(0,c.__)("Neu","gutenblock-pro"))),(0,t.createElement)("div",{className:"gb-ai-btn-row"},(0,t.createElement)(l.Button,{isSecondary:!0,onClick:()=>B("VerlÃ¤ngere den Text um 10%."),disabled:a||!x,size:"small"},(0,c.__)("+10%","gutenblock-pro")),(0,t.createElement)(l.Button,{isSecondary:!0,onClick:()=>B("KÃ¼rze den Text um 10%."),disabled:a||!x,size:"small"},(0,c.__)("-10%","gutenblock-pro")),(0,t.createElement)(l.Button,{isSecondary:!0,onClick:async()=>{i(!0),k(""),m(e,!0);try{const t=g(n,r);if(!t||t.length<3)return k((0,c.__)("Mindestens 3 Zeichen Text erforderlich","gutenblock-pro")),m(e,!1),void i(!1);const o=await u()({path:"/gutenblock-pro/v1/ai/generate",method:"POST",data:{prompt:`Ãœbersetze den folgenden Text ins Englische. Antworte nur mit der Ãœbersetzung:\n\n${t}`,blockName:"translation"}});o.success&&o.text&&(b(e,n,o.text,C),o.usage&&_(o.usage))}catch(e){k(e.message||(0,c.__)("Fehler bei der Ãœbersetzung","gutenblock-pro"))}finally{i(!1),m(e,!1)}},disabled:a,size:"small"},(0,c.__)("â†’ EN","gutenblock-pro"))))),p&&(0,t.createElement)(l.PanelRow,null,(0,t.createElement)(l.Notice,{status:"error",isDismissible:!1},p)))};function g(e,t){switch(e){case"core/paragraph":case"core/heading":case"core/list-item":return t?.content||"";case"core/button":return t?.text||"";default:return""}}function b(e,t,n,r){switch(t){case"core/paragraph":case"core/heading":case"core/list-item":r(e,{content:n});break;case"core/button":r(e,{text:n})}}const k=(0,r.createHigherOrderComponent)(e=>n=>{const{clientId:r,name:l,attributes:c}=n,s=window.gutenblockProConfig?.hasPremium||!1,[i,u]=(0,o.useState)(!1);return(0,o.useEffect)(()=>{const e=()=>{const e=document.querySelector(`[data-block="${r}"]`);if(e){const t=e.classList.contains("gb-pattern-premium")||null!==e.closest(".gb-pattern-premium");u(t)}},t=setTimeout(e,100),n=new MutationObserver(e),o=document.querySelector(`[data-block="${r}"]`);return o&&n.observe(o,{attributes:!0,subtree:!0}),()=>{clearTimeout(t),n.disconnect()}},[r]),i&&!s?(0,t.createElement)(e,{...n}):(0,t.createElement)(o.Fragment,null,(0,t.createElement)(e,{...n}),(0,t.createElement)(a.InspectorControls,null,(0,t.createElement)(p,{clientId:r,blockName:l,attributes:c})))},"withAIControls");(0,n.addFilter)("editor.BlockEdit","gutenblock-pro/ai-controls",k,10),(0,n.addFilter)("blocks.registerBlockType","gutenblock-pro/premium-block-supports",(e,t)=>("core/cover"!==t&&"core/group"!==t||e.supports,e),999),(0,r.createHigherOrderComponent)(e=>n=>{const{clientId:r,attributes:s,name:i}=n,u=window.gutenblockProConfig?.hasPremium||!1,m=window.gutenblockProConfig?.upgradeUrl||"https://app.gutenblock.com/licenses",d="core/cover"===i||"core/group"===i,p=s?.className||"";return d&&(p.includes("gb-section-hero-v2")||p.includes("gb-section-cta-v1")||p.includes("gb-pattern-premium"))&&!u?(console.log("[GutenBlock Pro] ðŸ”’ Locking premium pattern:",r,p),(0,t.createElement)(o.Fragment,null,(0,t.createElement)(e,{...n}),(0,t.createElement)(a.InspectorControls,null,(0,t.createElement)(l.PanelBody,{title:(0,c.__)("Premium Pattern","gutenblock-pro"),initialOpen:!0,"data-gb-premium-notice":"true"},(0,t.createElement)(l.PanelRow,null,(0,t.createElement)(l.Notice,{status:"warning",isDismissible:!1},(0,t.createElement)("p",{style:{marginBottom:"12px"}},(0,t.createElement)("strong",null,(0,c.__)("ðŸ”’ Pro Plus erforderlich","gutenblock-pro"))),(0,t.createElement)("p",{style:{marginBottom:"12px"}},(0,c.__)("Dieses Pattern kann als Vorschau eingefÃ¼gt werden, ist aber nur mit GutenBlock Pro Plus bearbeitbar.","gutenblock-pro")),(0,t.createElement)(l.Button,{isPrimary:!0,onClick:()=>window.open(m,"_blank"),style:{marginTop:"8px"}},(0,c.__)("Jetzt upgraden","gutenblock-pro")))))))):(0,t.createElement)(e,{...n})},"withPremiumBlockLock"),console.log("GutenBlock Pro AI loaded")})();